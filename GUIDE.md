# Implementing a Responsive Theme Switcher in your Next.js Application

Example repository: [App Router Theme Switcher Repo](https://github.com/LadyBluenotes/nextjs-clerk-themeswitch).

Many modern applications provide a theme switcher, enabling users to effortlessly toggle between light and dark modes based on their preferences. This guide will walk you through integrating this functionality into your Next.js app, ensuring that both the core application and [Clerk components](https://clerk.com/docs/components/overview) are consistently styled based on the selected theme.

This guide assumes you are coming from [Clerk’s Next.js Quickstart (App Router) guide](https://clerk.com/docs/quickstarts/nextjs).

## 1. Install required packages

First, install the necessary packages:

```bash
pnpm add next-themes @clerk/themes
```

- [`next-themes`](https://github.com/pacocoursey/next-themes): A simple library for handling theme switching in Next.js. It provides an easy-to-use API for toggling between light, dark, and system themes. It supports both client-side and server-side rendering.
- [`@clerk/themes`](https://clerk.com/docs/customization/themes): Clerk offers some prebuilt themes to make styling your components easier.

## 2. Set up the providers

### `theme-provider.tsx`

To manage theme switching effectively, the `ThemeProvider` component from `next-themes` is used. This component provides theme management and automatically handles toggling between light and dark themes.

1. In your project’s `src/` directory, create a `providers/` folder, if it doesn’t already exist.
2. Within this directory, create a file called `theme-provider.tsx` with the following code. The `mounted` state ensures that the theme is applied only after client-side rendering is complete, avoiding hydration mismatches.

```tsx
// theme-provider.tsx
"use client";

import * as React from "react";
import { ThemeProvider as NextThemeProvider } from "next-themes";

export function ThemeProvider({
	children,
	...props
}: React.ComponentProps<typeof NextThemeProvider>) {
	const [mounted, setMounted] = React.useState(false);

	// Only render content after first client-side mount
	React.useEffect(() => {
		setMounted(true);
	}, []);

	// Return null on server-side and first render
	if (!mounted) return null;

	// Only render theme provider when we're on the client
	return <NextThemeProvider {...props}>{children}</NextThemeProvider>;
}
```

### `clerk-provider.tsx`

To ensure that Clerk components respect the selected theme, [`ClerkProvider`](https://clerk.com/docs/components/clerk-provider) will need to be updated.

1. In the `providers/` directory, create a file named `clerk-provider.tsx` with the following code. Using `resolvedTheme` from `next-themes`, the `ClerkProvider` can now apply Clerk’s dark themes to components when `dark` is selected.

```tsx
"use client";

import { ClerkProvider } from "@clerk/nextjs";
import { dark } from "@clerk/themes";
import { useTheme } from "next-themes";

export default function _ClerkProvider({
	children,
}: {
	children: React.ReactNode;
}) {
	const { resolvedTheme } = useTheme();

	return (
		<ClerkProvider
			appearance={resolvedTheme === "dark" ? { baseTheme: dark } : undefined}
		>
			{children}
		</ClerkProvider>
	);
}
```

## 3. Update the root layout

To make sure the theme switching is in place globally, the root layout (`app/layout.tsx`) needs to be updated to include both `ThemeProvider` and `ClerkProvider`.

1. In `app/layout.tsx`, modify the root layout to include the theme and Clerk providers. By setting `attribute="class"` in the `ThemeProvider`, you ensure that theme changes are reflected when toggling between different modes. Additionally, `enableSystem` and `defaultTheme="system"` ensures that the theme automatically adapts to the user's system preferences, applying the correct theme (light or dark) without the need to manually specify a default.

```tsx
import type { Metadata } from "next";
import {
	SignInButton,
	SignUpButton,
	SignedIn,
	SignedOut,
	UserButton,
} from "@clerk/nextjs";
import { ThemeProvider } from "../providers/theme-provider";
import ClerkProvider from "../providers/clerk-provider";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";

const geistSans = Geist({
	variable: "--font-geist-sans",
	subsets: ["latin"],
});

const geistMono = Geist_Mono({
	variable: "--font-geist-mono",
	subsets: ["latin"],
});

export const metadata: Metadata = {
	title: "Clerk Next.js Quickstart",
	description: "Generated by create next app",
};

export default function RootLayout({
	children,
}: Readonly<{
	children: React.ReactNode;
}>) {
	return (
		<html lang="en">
			<body
				className={`${geistSans.variable} ${geistMono.variable} antialiased`}
			>
				<ThemeProvider
					attribute="class"
					defaultTheme="system"
					enableSystem
				>
					<ClerkProvider>
						<header>
							<SignedOut>
								<SignInButton />
								<SignUpButton />
							</SignedOut>
							<SignedIn>
								<UserButton />
							</SignedIn>
						</header>
						{children}
					</ClerkProvider>
				</ThemeProvider>
			</body>
		</html>
	);
}
```

### 4. Test the theme switcher with Clerk components

Now, you can test whether the theme switcher functions correctly, including in Clerk’s components.

1. In `app/page.tsx` directory, update it with the following code.

```tsx
"use client";

import Image from "next/image";
import styles from "./page.module.css";
import { useTheme } from "next-themes";
import { SignIn } from "@clerk/nextjs";

export default function Home() {
	const { setTheme } = useTheme();
	return (
		<div className={styles.page}>
			<div>
				<button onClick={() => setTheme("light")}>Light</button>
				<button onClick={() => setTheme("dark")}>Dark</button>
				<button onClick={() => setTheme("system")}>System</button>
			</div>
			<SignIn />
			<main>{/* ... rest of code */}</main>
		</div>
	);
}
```

> [!Note]
> When testing the theme switcher on this page with the <SignIn /> component, you will an error indicating that the component is not configured correctly. This occurs because the component assumes you're trying to create a sign-in page.
>
> If your goal is to create a customized sign-in page, follow Clerk's [guide on customizing your sign-in or sign-up page](https://clerk.com/docs/references/nextjs/custom-sign-in-or-up-page) for step-by-step instructions on how to configure the component properly.

### Customizing CSS for theme switching

When using the default CSS from the quickstart guide, you might notice that the styles don't automatically update when toggling the theme. This happens because the default setup uses the [`prefers-color-scheme` media feature](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-color-scheme), which does not automatically respond to theme changes made by `next-themes`.

With setting `attribute="class"` on the `ThemeProvider`, a `dark` class will be added to the root element when the dark theme is active. For your CSS to reflect this change, you can replace `prefers-color-scheme` with the `dark` class:

**Before** (with `prefers-color-scheme`):

```css
@media (prefers-color-scheme: dark) {
	:root {
		--background: #0a0a0a;
		--foreground: #ededed;
	}
}
```

**After** (with the `dark` class from `next-themes`):

```css
:root.dark {
	--background: #0a0a0a;
	--foreground: #ededed;
}
```
